tinymce.PluginManager.requireLangPack("codemirror");tinymce.PluginManager.add("codemirror",function(l,m){function e(){l.focus();l.selection.collapse(true);if(l.settings.codemirror.saveCursorPosition){l.selection.setContent('<span style="display: none;" class="CmCaReT">&#x0;</span>')}var c;var e=tinyMCE.baseURL.indexOf("/static/");if(e>0){c=tinyMCE.baseURL.substring(0,e)}else{c=window.location.origin}var t="?CodeMirrorPath="+l.settings.codemirror.path+"&ParentOrigin="+window.location.origin;var o=800;if(l.settings.codemirror.width){o=l.settings.codemirror.width}var n=550;if(l.settings.codemirror.height){n=l.settings.codemirror.height}var i=tinymce.majorVersion<5?[{text:"Ok",subtype:"primary",onclick:function(){var e=document.querySelectorAll(".mce-container-body>iframe")[0];e.contentWindow.submit();a.close()}},{text:"Cancel",onclick:"close"}]:[{type:"custom",text:"Ok",name:"codemirrorOk",primary:true},{type:"cancel",text:"Cancel",name:"codemirrorCancel"}];var r={title:"HTML source code",url:m+"/source.html"+t,width:o,height:n,resizable:true,maximizable:true,fullScreen:l.settings.codemirror.fullscreen,saveCursorPosition:false,buttons:i,onClose:function(){window.removeEventListener("message",d)}};if(tinymce.majorVersion>=5){r.onAction=function(e,t){if(t.name==="codemirrorOk"){s({type:"save"})}else if(t.name==="codemirrorCancel"){s({type:"cancel"});a.close()}}}var a=tinymce.majorVersion<5?l.windowManager.open(r):l.windowManager.openUrl(r);var s=function(e){a.sendMessage(e)};var d=function(e){if(c!==e.origin){return}var t;if(e.data.type==="init"){t={content:l.getContent({source_view:true})};l.fire("ShowCodeEditor",t);s({type:"init",content:t.content});l.dom.remove(l.dom.select(".CmCaReT"))}else if(e.data.type==="setText"){t={content:e.data.text};var o=e.data.isDirty;l.fire("SaveCodeEditor",t);l.setContent(t.content);var n=l.dom.select("span#CmCaReT")[0];if(n){l.selection.scrollIntoView(n);l.selection.setCursorLocation(n,0);l.dom.remove(n)}else{var i=l.getContent();var r=i.replace('<span id="CmCaReT"></span>',"");if(i!==r){l.setContent(r)}}l.isNotDirty=!o;if(o){l.nodeChanged()}}else if(e.data.type==="closeWindow"){a.close()}};window.addEventListener("message",d,false)}if(tinymce.majorVersion<5){l.addButton("code",{title:"Source code",icon:"code",onclick:e});l.addMenuItem("code",{icon:"code",text:"Source code",context:"tools",onclick:e})}else{l.ui.registry.addButton("code",{text:"HTML",tooltip:"Edit HTML",onAction:e});l.ui.registry.addMenuItem("code",{icon:"sourcecode",text:"Edit HTML",onAction:e,context:"tools"})}});